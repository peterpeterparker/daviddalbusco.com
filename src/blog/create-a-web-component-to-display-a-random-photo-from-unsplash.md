---
path: "/blog/create-a-web-component-to-display-a-random-photo-from-unsplash"
date: "2019-05-29"
title: "Create a Web Component to display a random photo from Unsplash"
description: "A tutorial to create with StencilJS your own Web Component which display a random photo from Unsplash"
tags: "#webdev #javascript #showdev #stencil"
image: "https://cdn-images-1.medium.com/max/2400/1*TlvBM-zGT1x7SmVMlKyAuQ.jpeg"
---

![](https://cdn-images-1.medium.com/max/2400/1*TlvBM-zGT1x7SmVMlKyAuQ.jpeg)
_Photo by [Mat Reding](https://unsplash.com/photos/QdqK4doOzcQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)_

I recently integrated the [Unsplash](https://unsplash.com) API to our upcoming open source web editor for presentations, [DeckDeckGo](https://deckdeckgo.com), and I thought that sharing my small learning experience in a new blog post might maybe, who knows, help someone in the future üòâ Therefore, in the following article, I will show you how to create your own Web Component to display a random photo from Unsplash.

![](https://cdn-images-1.medium.com/max/1600/1*xjFa1A-sWUNKUnn9Lyh1kg.gif)
_Our goal is to create such a component which fetch a new random photo on each browser refresh_

### Web Components with StencilJS

When it comes to Web Components, I‚Äôve got a bit more experience with [StencilJS](https://stenciljs.com) as any other compilers as I‚Äôm developing DeckDeckGo with. That‚Äôs why I will use it for the purpose of this tutorial. If you never used it before, don‚Äôt be afraid, it‚Äôs super straight forward, really developer friendly and fun, give it a try!

### Unsplash vs Pixabay

You might ask yourself why Unsplash instead of [Pixabay](https://pixabay.com) or any other stock photos services? Well first of all, I only compared these two üòÇ Secondly, they both have their assets but Unsplash is better suited for our needs.

The main difference in the two services is the way they provide their images. If you use Unsplash, you have to use ‚Äú[hotlink images](https://help.unsplash.com/api-guidelines/more-on-each-guideline/guideline-hotlinking-images)‚Äù, which means that images remains hosted by them. On the other side, if you would use the Pixabay API, you would have to self host the images (see [‚Äúhotlinking‚Äú](https://pixabay.com/api/docs/) in their documentation). Furthermore, if you would use Pixabay, you would have to cache every requests for 24 hours too, which I personally find a bit annoying to implement (no offense). That being said, Unsplash needs a bit of backend or cloud functions implementation too, as you have to keep your access key secret.

Like I said above, all in all, I found Unsplash better suited for our needs. But I tried both, you could even have a look at the [commit](https://github.com/deckgo/deckdeckgo/commit/d7798cafc93f7b7ca15e98034eb9ed5c12ffe764#diff-09fc8f8165c7427a9fb91c8b553dbd41) I did to migrate from one to the other üòÑ

### Prerequisite

In order to use the Unsplash API, you would need to register yourself and your application in order to get an ‚ÄúAccess Key‚Äù. These steps could be executed on their website [https://unsplash.com/developers](https://unsplash.com/developers). It is straight forward, therefore I won‚Äôt document it in this blog post but if you would face any difficulties, don‚Äôt hesitate to ping me for any questions, I would be happy to help, if I am able to üòá

### Getting started

To begin our journey, we are going to create a new Web Component using StencilJS with the command line `npm init stencil`.

_In this particular post, I‚Äôm going to step the details. If you never kickstarted such a component before, you could have a look to the ‚ÄúGetting started‚Äù chapter of a [previous article](https://dev.to/daviddalbusco/create-a-web-component-to-lazy-load-images-using-intersection-observer-45gf) I wrote for more details._

Once the component created, we could open the file `src/components/my component.tsx` in our favorite editor and remove the default code generated by the CLI in order to have an empty class at our disposal:

```
import { Component, h } from '@stencil/core';

@Component({
  tag: 'my-component',
  styleUrl: 'my-component.css',
  shadow: true
})
export class MyComponent {
}
```

_The imported `h` from `@stencil/core` is something new related to Stencil One. If you would use a previous Stencil version, just don‚Äôt import it._

#### Rendering an image

Our goal is to display a random stock photo from Unsplash, so guess what, we are now going to add an image to our component. Furthermore, as we are going to fetch its URI from the Unsplash API, we are going to define a variable which should contains this value.

_If you are new to StencilJS, let me try to summarize. There are no Html templates in Stencil, it uses [JSX](https://stenciljs.com/docs/templating-jsx/). Each component as a `render` function that returns what needs to be displayed. Furthermore, we are annotating our variable as `State()` telling the component that each modifications on this particular variable should trigger a new call of the `render` function._

```
import {Component, State, h} from '@stencil/core';

@Component({
  tag: 'my-component',
  styleUrl: 'my-component.css',
  shadow: true
})
export class MyComponent {

  @State() imgSrc: string;

  render() {
    return this.imgSrc ? <img src={this.imgSrc}/> : undefined;
  }
}
```

#### Querying a random photo from Unsplash

Unsplash provide wrappers for their API in various languages. For Javascript they notably provide the [unsplash-js](https://github.com/unsplash/unsplash-js) wrapper. I didn‚Äôt used it neither in our application nor in this tutorial. Firstly because it would not have really reduced the amount of work for me, as my requirements were really lean, and secondly because, mostly for performances reason, I rather like to have just a few line of codes in DeckDeckGo than a dependance on a all library which offers way more features than what we need.

#### ‚ö†Ô∏è **Important** ‚ö†Ô∏è

![](https://cdn-images-1.medium.com/max/1600/1*0rzkOPaCAk3buGtKj5ysjQ.gif)

For the purpose of this tutorial, I will display pieces of code where the Unsplash API is queried directly (https://api.unsplash.com/). **DO NOT** do that in any applications, real or not, that you would upload online. Your Unplash access key has to remain secret. Furthermore, don‚Äôt ‚Äúforget‚Äù to give back [credits](https://unsplash.com/documentation#guidelines--crediting) to the authors of the photos.

#### Fetching a random photo

The Unsplash API exposes an endpoint ‚Äú[random photo](https://unsplash.com/documentation#get-a-random-photo)‚Äù, which, guess what, would allow us to request and get a random photo from their collections üòú Therefore we are just going to implement a function which perform this (HTTPS) getter and filter the results in order to find the hotlinked url of the image.

_Unsplash provide different format (‚Äúfull‚Äù, ‚Äúraw‚Äù, ‚Äùregular‚Äù, ‚Äúsmall‚Äù and ‚Äúthumb‚Äù) of their images. In this example I used the ‚Äúthumb‚Äù size._

```
private getRandomPhoto(): Promise<string> {
  return new Promise<string>(async (resolve) => {
    const searchUrl: string =
                     'https://api.unsplash.com/photos/random/' +
                     `?client_id=${YOUR_ACCESS_KEY}`;
    try {
      const rawResponse: Response = await fetch(searchUrl);

      const response = JSON.parse(await rawResponse.text());
      if (!response) {
         resolve(undefined);
         return;
      }
      resolve(response.urls && response.urls.thumb ?
              response.urls.thumb : undefined);
    } catch (err) {
      resolve(undefined);
    }
  });
}
```

We are interested to fetch automatically a photo. We could therefore hook on a component loading [lifecycle](https://stenciljs.com/docs/component lifecycle) and call our `getRandomPhoto` function to assign its result to the variable `imgSrc` we have defined before.

```
async componentWillLoad() {
  this.imgSrc = await this.getRandomPhoto();
}
```

#### Track a photo download

Our solution is almost ready but we have to add one last piece: Unsplash requires a trigger on their ‚Äú[download](https://unsplash.com/documentation#track-a-photo-download)‚Äù endpoint when an image is downloaded (you could find more information about when and why this should happen in their [guidelines](https://help.unsplash.com/api-guidelines/guideline-triggering-a-download)). To call this end point we could create another (HTTPS) getter.

```
private registerDownload(photoId: string): Promise<void> {
  return new Promise<void>(async (resolve) => {
    const downloadUrl: string =
         'https://api.unsplash.com/' +
         `photos/${photoId}/download/?client_id=${YOUR_ACCESS_KEY}`;

    try {
      await fetch(downloadUrl);

      resolve();
    } catch (err) {
      resolve();
    }
  });
}
```

Obviously, now that we have created a new function, we should call it üòÜ As the endpoint requires the ID of the photo, we could call it from our previous function `getRandomPhoto` before we return the url of the image.

_In a real implementation, I would first apply and render the url of the image and then call the download endpoint, but I thought that doing it this way for the purpose of this article would be make the code clearer to explain._

```
await this.registerDownload(response.id);
```

That‚Äôs it, our component is ready üéâ

#### All together

![](https://cdn-images-1.medium.com/max/1600/1*IV5q7-l-VsZMkuKUiZ1giA.gif)

Before trying it out, let me just summarize all the component code‚Äôs at once:

```
import {Component, State, h} from '@stencil/core';

@Component({
  tag: 'my-component',
  styleUrl: 'my-component.css',
  shadow: true
})
export class MyComponent {

  @State() imgSrc: string;

  async componentWillLoad() {
    this.imgSrc = await this.getRandomPhoto();
  }

  private getRandomPhoto(): Promise<string> {
    return new Promise<string>(async (resolve) => {
      const searchUrl: string =
                     'https://api.unsplash.com/photos/random/' +
                     `?client_id=${YOUR_ACCESS_KEY}`;
     try {
        const rawResponse: Response = await fetch(searchUrl);

        const response = JSON.parse(await rawResponse.text());

        if (!response) {
          resolve(undefined);
          return;
        }

        await this.registerDownload(response.id);

        resolve(response.urls && response.urls.thumb ?
                response.urls.thumb : undefined);
      } catch (err) {
        resolve(undefined);
      }
    });
  }

  private registerDownload(photoId: string): Promise<void> {
    return new Promise<void>(async (resolve) => {
      const downloadUrl: string =
         'https://api.unsplash.com/' +
         `photos/${photoId}/download/?client_id=${YOUR_ACCESS_KEY}`;

      try {
        await fetch(downloadUrl);

        resolve();
      } catch (err) {
        resolve();
      }
    });
  }

  render() {
    return this.imgSrc ? <img src={this.imgSrc}/> : undefined;
  }
}
```

### Trying it out

Good we are ready to test our component. StencilJS comes with a handy local test server, therefore just run `npm run start` in a command line and open your browser at the address `http://localhost:3333`. If everything works as expected, a random stock photo should be displayed and a new one should be fetched each time you would refresh your page.

![](https://cdn-images-1.medium.com/max/1600/1*xjFa1A-sWUNKUnn9Lyh1kg.gif)

### Cherry on the cake üçíüéÇ

As I said in my introduction, we have integrated the Unsplash API in [DeckDeckGo](https://deckdeckgo.com), our upcoming open source web editor for presentations, to ease the integration of stock photos. This implementation isn‚Äôt really that different from what we implemented in this tutorial (instead of a random photo, we are just fetching a list). Therefore, as we are open source, if you are looking for a real example of implementation, you could just have a look at our [source code](https://github.com/deckgo/deckdeckgo) üòÉ

![](https://cdn-images-1.medium.com/max/1600/1*nCyubS5I7eIwuIB7_DseLQ.gif)

To infinity and beyond üöÄ

David
